<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="js/jquery-3.6.0.min.js">
    <link rel="stylesheet" href="js/bootstrap.min.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/2.3.1/css/flag-icon.min.css" rel="stylesheet"/>
    <style>
    .cajaAmarilla{
        margin: 0.5%;
        background-color: #FE0;
        border: blue 2px solid;
        border-radius: 7px;
        height: 24px;
    }  
    #container {
        align-items: center;
        display:         flex;
        flex-wrap:       wrap;
        justify-content: center;
    }
    .recuadros{
        margin: auto;
        color: grey;
        text-align: center;
        background-color: whitesmoke;
        box-sizing: border-box;
        border: black;
        border-width: 1px;
        border-style: solid;
    }
    .centro{
        text-align: center;
    }
    .botones{
        color: white;
        text-align: center;
        background-color: blue;
        width: 50px;
        height: 40px;
        border-radius: 12px;
        box-sizing: border-box;
        border: white;
        border-width: 1px;
        border-style: solid;
    }    
    </style>
</head>
<body>
    <!-- TODO quitar los botones de testeo, y quizá añadir uno de salir. -->
    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/listaVerbos-1.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>



    <div id="VentanaInicialId">
        <hr color="blue" style="height:10px;border-radius: 8px;width: 100%;">
        <div class="recuadros">
            <span class="flag-icon flag-icon-gb"></span> Test Verbos Irregulares <span class="flag-icon flag-icon-gb"></span>
        </div>
        <br>
        <div class="centro">
            <div>Niveles Completados</div>
            <br>
            <i id="copa20" class="bi-trophy"></i> <i id="copa30" class="bi-trophy"> </i><i id="copa40" class="bi-trophy"></i>
            <i id="copa50" class="bi-trophy"></i> <i id="copa60" class="bi-trophy"> </i><i id="copa70" class="bi-trophy"></i>
            <i id="copa80" class="bi-trophy"></i> <i id="copa90" class="bi-trophy"> </i><i id="copa140" class="bi-trophy"></i>
        </div>
        <br>
        <div class="recuadros">
            <p style="color: grey; margin: 5px;"><i class="bi bi-book"> </i>Elige el numero de verbos <i class="bi bi-book"></i> </p> 
        </div>
        <br>
        <div class="centro">
            <input onclick="cantidadDeVerbos(this)" id="20" class="botones" type="button" value="20">
            <input onclick="cantidadDeVerbos(this)" id="30" class="botones" type="button" value="30">
            <input onclick="cantidadDeVerbos(this)" id="40" class="botones" type="button" value="40">
            <input onclick="cantidadDeVerbos(this)" id="50" class="botones" type="button" value="50">
            <input onclick="cantidadDeVerbos(this)" id="60" class="botones" type="button" value="60">
            <br>
            <br>
            <input onclick="cantidadDeVerbos(this)" id="70" class="botones" type="button" value="70">
            <input onclick="cantidadDeVerbos(this)" id="80" class="botones" type="button" value="80">
            <input onclick="cantidadDeVerbos(this)" id="90" class="botones" type="button" value="90">
            <input onclick="cantidadDeVerbos(this)" id="140" class="botones" type="button" value="140">
        </div>
        <hr color="blue" style="height:10px;border-radius: 8px;width: 100%;">    
    </div>    
    <div id="VentanaJuego" class="centro">
        <hr color="blue" style="height:10px;border-radius: 8px;width: 100%;">    
        <!-- Fondo azul con el numero de Nivel que estamos -->
        <div id="LineaNivel" class="recuadros" onclick="establecerVerbosIniciales()", oncreate="cambiarTextoNivel()"></div>
        <br>
        <!-- Linea de las estrellas -->
        <div id="lineaEstrellas">
            <!-- Estrellas definidas cada una con su id -->
            <i id=estrella1 class="bi-star"></i> 
            <i id=estrella2 class="bi-star"></i>     
            <i id=estrella3 class="bi-star"></i>
            <i id=estrella4 class="bi-star"></i>
            <i id=estrella5 class="bi-star"></i>     
            <i id=estrella6 class="bi-star"></i>
            <i id=estrella7 class="bi-star"></i>   
            <i id=estrella8 class="bi-star"></i>    
        </div>
        <br> 
        <!-- Las tres cajas amarillas de las palabras ocultas -->
        <div id="container">                 
            <div id="caja0" class="cajaAmarilla">
                <input style="width: 94px;height: 17px;" type="text" id="mensaje0">&nbsp;</input>
            </div>
            <div id="caja1" class="cajaAmarilla">
                <input style="width: 94px;height: 17px;" type="text" id="mensaje1">&nbsp;</input>
            </div>
            <div id="caja2" class="cajaAmarilla">
                <input style="width: 94px;height: 17px;" type="text" id="mensaje2">&nbsp;</input>
            </div> 
        </div>
        <br>
        <div>
            <div id="verboEspañol"></div>
        </div>
        <br>
        <!-- Los tres botones, para empezar o pasar entre niveles -->   
            <p id="botonesJugar">
                <!--<input type="button" value="NIVEL ANTERIOR" onclick="cambiarTextoBotonAnteriorNivel();"/>-->
                <input id="botonComprobarId" type="button" value="COMPROBAR" onclick="checkeaVerbo();"/>  
            </p>
            <br>
            <input type="button" value="Clica" onclick= "acertar()"/>
            <input type="button" value="Click para ocultar" onclick= "HideContent(listaElementosJuego)"/>
            <br>
            <hr color="blue" style="height:10px;border-radius: 8px;width: 100%;">    
            <input type="button" value="prueba" onclick="perder()"/>
        </div>
        <!-- Conjunto de funciones para el estado inicial del juego, incuido los verbos iniciales, el texto del nivel,
            y que verbos se pueden resolver. Tambien incluye la funcionde cuando acertamos-->
        <script>
            //
            //
            //VARIABLES
            //
            //
            //Variables de nuestras ventanas
            var listaElementosJuego = ['VentanaJuego'];
            var objetosIniciales = ['VentanaInicialId'];
            //Otras variables
            var listaEstrellas = ["estrella1","estrella2","estrella3","estrella4","estrella5","estrella6","estrella7","estrella8"]
            var verbosPosibles = 0
            var nivelActual = 0
            var stringNivel = "Nivel: " + nivelActual.toString()
            var numRandom = Math.floor(Math.random() * verbosPosibles);
            var aciertos = 1;
            var multi3 = 2;
            var botonComprobar = document.getElementById("botonComprobarId");
            //Variables de iconos
            var estrellaVacia = "bi-star";
            var estrellaMedia = "bi-star-half";
            var estrellaLlena = "bi-star-fill";
            var copaVacia = "bi-trophy";
            var copaLlena = "bi-trophy-fill";
            var nivel = 0;
            var valor1 = 0;
            var valor2 = 0;
            var valorMisterioso = 0;
            var espacioVacio = "";
            var palabraCorrecta = "";
            var elBotonCorrecto;
            var fallos = 0;
            var palabraEnEsp;
            var Conseguida20 = false;
            var Conseguida30 = false;
            var Conseguida40 = false;
            var Conseguida50 = false;
            var Conseguida60 = false;
            var Conseguida70 = false;
            var Conseguida80 = false;
            var Conseguida90 = false;
            var Conseguida140 = false;
            //
            //
            //
            //
            //
            //Miramos si tenemos 16 aciertos y si los tenemos hemos ganado
            function checkeaGanar(){
                if(aciertos == 16){
                    ganar();
                }
            }
            //Si aciertas 16 veces, volvemos a la pantalla principal y reseteamos los aciertos. Tambien te damos una copita
            function ganar(){
                HideContent(listaElementosJuego);
                ShowContent(objetosIniciales);
                resetValores();
                rellenaCopas();
            }
            function resetValores()
            {
                aciertos = 1;
                fallos = 0;
                multi3 = 2;
                reseteaEstrellas(listaEstrellas);
            }
            //Rellena las copas si cumples las condiciones
            function rellenaCopas(){
                copaActual = document.getElementById("copa"+verbosPosibles);
                $(copaActual).removeClass(copaVacia);
                $(copaActual).addClass(copaLlena);
                booleanoActual = document.getElementById("Conseguida"+verbosPosibles);
                booleanoActual = true;
                setCookie(verbosPosibles, 1, 100);
            }
            function rellenaCopasCookies(laGalleta){
                copaActual = document.getElementById("copa"+laGalleta);
                $(copaActual).removeClass(copaVacia);
                $(copaActual).addClass(copaLlena);
                booleanoActual = document.getElementById("Conseguida"+verbosPosibles);
                booleanoActual = true;
            }
            //Ponemos en la parte de arriba los niveles que hemos seleccionado
            function seteaNivel(){
                document.getElementById("LineaNivel").innerHTML = "Nivel " + verbosPosibles;
            }
            //Verbos que aparecen al principio del programa, uno de ellos estará oculto
            function establecerVerbosIniciales()
            {
                var verboForma1 = verbos[nivelActual][0],
                verboForma2 = verbos[nivelActual][1],
                verboForma3 = verbos[nivelActual][2],
                verboFormaEspañol = verbos[nivelActual][3]
                console.log(verboForma1);
                console.log(verboForma2);
                console.log(verboForma3);
                console.log(verboFormaEspañol);                
            }
            //Verbo que está oculto  
            function verboAResolver() {
                numRandom = Math.floor(Math.random() * verbosPosibles);
            }
            //Según el nivel elegido, esta será la cantidad de verbos, y por lo tanto su dificultad
            function cantidadDeVerbos(btn){
                var numeroVerbos = btn.value;
                verbosPosibles = parseInt(numeroVerbos);
                HideContent(objetosIniciales);
                ShowContent(listaElementosJuego);
                cambiarTextoBotonInicial();               
            }
            //
            function checkeaVerbo() {
                console.log("La palabra correcta es " + palabraCorrecta);
                console.log("Has escrito " + elBotonCorrecto.value);
                if(palabraCorrecta == elBotonCorrecto.value)
                {
                        actualizaEstrellas();
                        acertar();
                        cambiarTextoBotonSiguienteNivel();         
                }
                else
                {
                    fallar();
                    checkeaPerder();
                }
            }
            function reseteaEstrellas(obj){               
                for(var i=0; i < obj.length; i++){    
                    var laEstrella = document.getElementById([obj[i]]);             
                    $(laEstrella).removeClass(estrellaMedia);
                    $(laEstrella).removeClass(estrellaLlena);
                    $(laEstrella).addClass(estrellaVacia);
                }
            }
            function checkeaPerder(){
                if(fallos == 3){
                    perder();
                }
            }
            function perder()
            {
                HideContent(listaElementosJuego);
                ShowContent(objetosIniciales);
                resetValores();
            }
            function acertar()
            {
                botonComprobar.style.background='#008000';
                aciertos++;
                checkeaGanar();
            }
            function fallar()
            {
                botonComprobar.style.background='#ff0000';
                fallos++;
            }
            

            function pillaGalletas(){
               
                if(getCookie("20")){
                    Conseguida20 = true;
                    rellenaCopasCookies("20");
                }
                if(getCookie("30")){
                    Conseguida30 = true;
                    rellenaCopasCookies("30");
                }
                if(getCookie("40")){
                    Conseguida40 = true;
                    rellenaCopasCookies("40");
                }
                if(getCookie("50")){
                    Conseguida50 = true;
                    rellenaCopasCookies("50");
                }
                if(getCookie("60")){
                    Conseguida60 = true;
                    rellenaCopasCookies("60");
                }
                if(getCookie("70")){
                    Conseguida70 = true;
                    rellenaCopasCookies("70");
                }
                if(getCookie("80")){
                    Conseguida80 = true;
                    rellenaCopasCookies("80");
                }
                if(getCookie("90")){
                    Conseguida90 = true;
                    rellenaCopasCookies("90");
                }
                if(getCookie("140")){
                    Conseguida140 = true;
                    rellenaCopasCookies("140");
                }
            }

            window.onload = function() {
                HideContent(listaElementosJuego); 
                pillaGalletas();
            };
            //Funcion que se ejecuta al cerrar o cargar pagina
            window.onbeforeunload = function(){
                
            }
        //Script que sirve para medir los aciertos, y dependiendo de cuantos llevemos vamos cambiando el relleno de las estrellas                
            function actualizaEstrellas(){
                var estrellaActual = Math.ceil(aciertos/2);
                if(multi3 == 2){
                    var estrellaActualImagen = document.getElementById("estrella"+estrellaActual);
                    $(estrellaActualImagen).removeClass(estrellaVacia);
                    $(estrellaActualImagen).addClass(estrellaMedia);
                    multi3++;
                }else if(multi3 == 3){
                    estrellaActualImagen = document.getElementById("estrella"+estrellaActual);
                    $(estrellaActualImagen).removeClass(estrellaMedia);
                    $(estrellaActualImagen).addClass(estrellaLlena);
                    multi3 = 2;
                }
                console.log(aciertos+" aciertos llevamos");
            } 
        //Funcion para esconder objetos y revelar objetos
            function HideContent(obj) {
                for (var i = 0; i < obj.length; i++) {
                document.getElementById([obj[i]]).style.display = 'none';
                }
            }
            function ShowContent(obj) {
                for (var i = 0; i < obj.length; i++) {
                document.getElementById([obj[i]]).style.display = 'block';
                }
            }            
        //Script añadido por Colo 10/11, aqui se gestiona el cambiar las zonas de texto por las formas del verbo, poniendo dos random   
            function cambiarTextoBotonInicial()
            {   
                var elMensaje0 = document.getElementById("mensaje0");
                var elMensaje1 = document.getElementById("mensaje1");
                var elMensaje2 = document.getElementById("mensaje2");
                elMensaje0.value = espacioVacio;
                elMensaje1.value = espacioVacio;
                elMensaje2.value = espacioVacio;
                elMensaje0.disabled = false;
                elMensaje1.disabled = false;
                elMensaje2.disabled = false;
                botonComprobar.style.background="#a0a0a0";
                verboAResolver();
                seteaNivel();
                console.log(numRandom);
                var mensajeAOcultar1 = Math.floor(Math.random() * 3);
                var mensajeAOcultar2 = Math.floor(Math.random() * 3);
                do 
                {
                    mensajeAOcultar2 = Math.floor(Math.random() * 3);
                }
                while(mensajeAOcultar1 === mensajeAOcultar2);
                valor1 = mensajeAOcultar1;
                valor2 = mensajeAOcultar2;
                valorMisterioso = 3 - (valor1 + valor2);
                console.log("El valor a resolver es " + valorMisterioso);
                var mensaje1 = "mensaje" + mensajeAOcultar1.toString();
                var elBotonElegido1 = document.getElementById(mensaje1);
                elBotonElegido1.value = verbos[numRandom][mensajeAOcultar1];
                elBotonElegido1.disabled = true;
                var mensaje2 = "mensaje" + mensajeAOcultar2.toString();
                var elBotonElegido2 = document.getElementById(mensaje2);
                elBotonElegido2.value = verbos[numRandom][mensajeAOcultar2];
                elBotonElegido2.disabled = true;
                palabraCorrecta = verbos[numRandom][valorMisterioso];
                console.log("La palabra correcta es " + palabraCorrecta);
                $("#botonInicial").hide();
                var mensaje3 = "mensaje" + valorMisterioso.toString();
                elBotonCorrecto = document.getElementById(mensaje3);
                var mensajeEsp = document.getElementById("verboEspañol");
                mensajeEsp.innerHTML = verbos[numRandom][3];  
            }
            function cambiarTextoBotonSiguienteNivel()
            {   
                verboAResolver();
                console.log(numRandom);
                var elMensaje0 = document.getElementById("mensaje0");
                var elMensaje1 = document.getElementById("mensaje1");
                var elMensaje2 = document.getElementById("mensaje2");
                elMensaje0.value = espacioVacio;
                elMensaje1.value = espacioVacio;
                elMensaje2.value = espacioVacio;
                elMensaje0.disabled = false;
                elMensaje1.disabled = false;
                elMensaje2.disabled = false;
                //nivel++;
                var mensajeAOcultar1 = Math.floor(Math.random() * 3);
                var mensajeAOcultar2 = Math.floor(Math.random() * 3);
                do 
                {
                    mensajeAOcultar2 = Math.floor(Math.random() * 3);
                }
                while(mensajeAOcultar1 === mensajeAOcultar2);
                console.log("El primer valor resuelto es " + mensajeAOcultar1);
                console.log("El segundo valor resuelto es " + mensajeAOcultar2);
                valorMisterioso = 3 - (mensajeAOcultar1 + mensajeAOcultar2);
                console.log("El valor a resolver es " + valorMisterioso);
                var mensaje1 = "mensaje" + mensajeAOcultar1.toString();
                var elBotonElegido1 = document.getElementById(mensaje1);
                elBotonElegido1.value = verbos[numRandom][mensajeAOcultar1];
                elBotonElegido1.disabled = true;
                var mensaje2 = "mensaje" + mensajeAOcultar2.toString();
                var elBotonElegido2 = document.getElementById(mensaje2);
                elBotonElegido2.value = verbos[numRandom][mensajeAOcultar2];
                elBotonElegido2.disabled = true;
                palabraCorrecta = verbos[numRandom][valorMisterioso];
                var mensaje3 = "mensaje" + valorMisterioso.toString();
                elBotonCorrecto = document.getElementById(mensaje3);
                var mensajeEsp = document.getElementById("verboEspañol");
                mensajeEsp.innerHTML = verbos[numRandom][3];
            }
            function setCookie(cname, cvalue, exdays) {
                    const d = new Date();
                    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                    const expires = 'expires=' + d;
                    document.cookie = cname + '=' + cvalue + ';' + expires + d;
                    console.log("Añadida cookie " + cname + "Con valor " + cvalue);
                }
                function getCookie(name) {
                    var dc = document.cookie;
                    var prefix = name + "=";
                    var begin = dc.indexOf("; " + prefix);
                    if (begin == -1) {
                        begin = dc.indexOf(prefix);
                        if (begin != 0) return null;
                    }
                    else
                    {
                        begin += 2;
                        var end = document.cookie.indexOf(";", begin);
                        if (end == -1) {
                        end = dc.length;
                        }
                    }
                    // because unescape has been deprecated, replaced with decodeURI
                    //return unescape(dc.substring(begin + prefix.length, end));
                    return decodeURI(dc.substring(begin + prefix.length, end));
                } 
            function checkCookie(cname) {
                const cookie = window.CookieObj.getCookie(cname);
                if (cookie !== '') {
                    return true;
                }
                return false;
            }
            const cookies = (function () {
                return {
                    setCookie: (cname, cvalue, exdays) => {
                        const d = new Date();
                        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                        const expires = 'expires=' + d.toUTCString();
                        document.cookie = cname + '=' + cvalue + '; ' + expires;
                    },
                    getCookie: (cname) => {
                        const name = cname + '=';
                        const ca = document.cookie.split(';');
                        for (let i = 0; i < ca.length; i += 1) {
                            let c = ca[i];
                            while (c.charAt(0) === ' ') c = c.substring(1);
                            if (c.indexOf(name) === 0) return c.substring(name.length, c.length);
                        }
                        return '';
                    },
                    checkCookie: (cname) => {
                        const cookie = window.CookieObj.getCookie(cname);
                        if (cookie !== '') {
                            return true;
                        }
                        return false;
                    },
                };
            }());
            window.CookieObj = cookies;
            
            
            
            
        </script>
    </div>
</body>
</html>